#!/usr/bin/env ruby

require 'fileutils'

project_root = ENV['GAME_ROOT']

gemfile_path = File.join(project_root, "platform_support", "macos", "Gemfile").to_s

env = { "BUNDLE_GEMFILE" => gemfile_path }

Bundler.with_clean_env do
  system(env, "bundle check", out: File::NULL) ||
    system("bundle install --gemfile=#{gemfile_path}") || (
      STDERR.puts("Failed to bundle #{gemfile_path}") and exit(1)
      )


  entry = File.join(__dir__, "entry.rb")

  begin
    system(env, "bundle exec ruby #{entry}")
  rescue Interrupt
  end
end
